---
layout: diagram
title: Diagrams
weight: 3
---

    <div>
      <div class="control">
        <button onclick="toggleRouting()">Toggle auto-routing</button>

        <label for="scale">Scale</label>
        <input type="range" min="0.2" max="1" step="0.05" value="0.6" name="scale" oninput="setScale()" />
        <em id="scaleVal"></em>
      </div>
      <div id="paper"></div>
    </div>

    <script>
      "use strict";

      var paperSettings = {
        width: 1150,
        height: 850
      };

      var graph;
      var paper;
      var texts = [];
      var active = 'all';
      var routing = true;

      function setup() {
        graph = new joint.dia.Graph;
        paper = new joint.dia.Paper($.extend({}, {
          el: $('#paper'),
          gridSize: 5,
          model: graph,
          interactive: function(cellView) {
            var attr = cellView.model.attributes;
            if (attr.type === 'link') {
              return false;
            }
            var hasStroke = attr.attrs ? attr.attrs.rect['stroke-width'] !== 0 : false;
            return (attr.z < 0 || hasStroke);
          }
        }, paperSettings));

        graph.on('change:position', function(cell) {
          if (!cell) {
            return;
          }
          var parentId = cell.get('parent');
          if (!parentId) {
            return;
          }

          var parent = graph.getCell(parentId);
          if (!parent) {
            return;
          }
          var bbox = parent.getBBox();
          var cellBBox = cell.getBBox();

          if (bbox.containsPoint(cellBBox.origin()) &&
              bbox.containsPoint(cellBBox.topRight()) &&
              bbox.containsPoint(cellBBox.corner()) &&
              bbox.containsPoint(cellBBox.bottomLeft())) {

            // All the four corners of the child are inside
            // the parent area.
            return;
          }

          // Revert the child position.
          cell.set('position', cell.previous('position'));
        });

        paper.on('cell:pointerclick', function(cell, evt, x, y) {
          var attr = cell.model.attributes;
          if (attr.prop && attr.prop.linkTo) {
            var name = attr.prop.linkTo;
            if (name === active) {
              /* Go back to 'main'. */
              name = 'all';
            }
            active = name;
            diagram.clearTemp();
            render.generic(name);
            routing = true;
          }
        });
      }

      function toggleRouting() {
        var links = graph.getLinks();
        routing = !routing;
        if (routing) {
          links.forEach(function(x) { x.set('router', {name: 'manhattan'})})
        } else {
          links.forEach(function(x) { x.set('router', null)})
        }
      }

      function setScale() {
        var scale = parseFloat($('input[name="scale"]')[0].value);
        console.log('scale', scale);
        paper.scale(scale, scale);
        $('#scaleVal').text(Math.round(scale * 100) + '%');
      }

      setup();
      setScale();
      render.all();
      paper.fitToContent({padding: 2});
    </script>
